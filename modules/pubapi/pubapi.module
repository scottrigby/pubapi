<?php

/**
 * Implements hook_restws_resource_info().
 *
 * Adds a mapping layer between Publisher API and entity types.
 */
function pubapi_restws_resource_info() {
  $result = array();
  foreach (pubapi_get_structure() as $type => $info) {
    $result[$type] = array(
      'label' => $info['label'],
      'class' => 'PubApiResourceController',
    );
  }
  return $result;
}

/**
 * POC dummy map.
 *
 * This will be replaced by the mapping UI Alex R is working on.
 */
function pubapi_get_map() {
  $map = array();

  $map['show'] = array(
    'entity' => 'node', // Internal.
    'bundle' => 'page', // Internal.
    'name' => 'title',
    // @todo get automatically from entity_get_info().
    'id' => 'nid',
    'description' => 'body',
    'genre' => 'field_genre',
    'status' => 'status',
  );

  $map['season'] = array(
    'entity' => 'node',
    'bundle' => 'season',
    'name' => 'title',
    'id' => 'nid',
    'description' => 'body',
    'show' => 'field_show',
    'status' => 'status',
  );

  $map['episode'] = array(
    'entity' => 'node',
    'bundle' => 'episode',
    'name' => 'title',
    'id' => 'nid',
    'description' => 'body',
    'show' => 'field_show',
    'season' => 'field_season',
    'status' => 'status',
  );

  $map['blog'] = array(
    'entity' => 'node',
    'bundle' => 'article',
    'name' => 'title',
    'id' => 'nid',
    'description' => 'body',
    'show' => 'field_show',
    'season' => 'field_season',
    'episode' => 'field_episode',
    'status' => 'status',
  );

  return $map;
}

/**
 * POC structure.
 */
function pubapi_get_structure() {
  $structure = array();

  $structure['show'] = array(
    'label' => t('Show'),
    'properties' => array(
      'name' => array(
        'type' => 'text',
        'label' => t('Show name'),
        'setter callback' => 'entity_property_verbatim_set',
        'getter callback' => 'entity_property_verbatim_get',
      ),
      'id' => array(
        'type' => 'integer',
        'label' => t('Show ID'),
        'setter callback' => 'entity_property_verbatim_set',
        'getter callback' => 'entity_property_verbatim_get',
      ),
      'description' => array(
        'type' => 'text',
        'label' => t('Show description'),
        'setter callback' => 'entity_property_verbatim_set',
        'getter callback' => 'entity_property_verbatim_get',
      ),
      'genre' => array(
        'type' => 'text',
        'label' => t('Show genre'),
        'setter callback' => 'entity_property_verbatim_set',
        'getter callback' => 'entity_property_verbatim_get',
      ),
      'status' => array(
        'type' => 'integer',
        'label' => t('Show published status'),
        'setter callback' => 'entity_property_verbatim_set',
        'getter callback' => 'entity_property_verbatim_get',
      ),
    ),
  );

  $structure['season'] = array(
    'label' => t('Season'),
    'properties' => array(
      'name' => array(
        'type' => 'text',
        'label' => t('Season name'),
        'setter callback' => 'entity_property_verbatim_set',
        'getter callback' => 'entity_property_verbatim_get',
      ),
      'id' => array(
        'type' => 'integer',
        'label' => t('Season ID'),
        'setter callback' => 'entity_property_verbatim_set',
        'getter callback' => 'entity_property_verbatim_get',
      ),
      'description' => array(
        'type' => 'text',
        'label' => t('Season description'),
        'setter callback' => 'entity_property_verbatim_set',
        'getter callback' => 'entity_property_verbatim_get',
      ),
      'show' => array(
        'type' => 'integer',
        'label' => t("The season's show ID"),
        'setter callback' => 'entity_property_verbatim_set',
        'getter callback' => 'entity_property_verbatim_get',
      ),
      'status' => array(
        'type' => 'integer',
        'label' => t('Season published status'),
        'setter callback' => 'entity_property_verbatim_set',
        'getter callback' => 'entity_property_verbatim_get',
      ),
    ),
  );

  $structure['episode'] = array(
    'label' => t('Episode'),
    'properties' => array(
      'name' => array(
        'type' => 'text',
        'label' => t('Episode name'),
        'setter callback' => 'entity_property_verbatim_set',
        'getter callback' => 'entity_property_verbatim_get',
      ),
      'id' => array(
        'type' => 'integer',
        'label' => t('Episode ID'),
        'setter callback' => 'entity_property_verbatim_set',
        'getter callback' => 'entity_property_verbatim_get',
      ),
      'description' => array(
        'type' => 'text',
        'label' => t('Episode description'),
        'setter callback' => 'entity_property_verbatim_set',
        'getter callback' => 'entity_property_verbatim_get',
      ),
      'show' => array(
        'type' => 'integer',
        'label' => t("The episode's show ID"),
        'setter callback' => 'entity_property_verbatim_set',
        'getter callback' => 'entity_property_verbatim_get',
      ),
      'season' => array(
        'type' => 'integer',
        'label' => t("The episode's season ID"),
        'setter callback' => 'entity_property_verbatim_set',
        'getter callback' => 'entity_property_verbatim_get',
      ),
      'status' => array(
        'type' => 'integer',
        'label' => t('Episode published status'),
        'setter callback' => 'entity_property_verbatim_set',
        'getter callback' => 'entity_property_verbatim_get',
      ),
    ),
  );

  $structure['blog'] = array(
    'label' => t('Blog'),
    'properties' => array(
      'name' => array(
        'type' => 'text',
        'label' => t('Blog name'),
        'setter callback' => 'entity_property_verbatim_set',
        'getter callback' => 'entity_property_verbatim_get',
      ),
      'id' => array(
        'type' => 'integer',
        'label' => t('Blog ID'),
        'setter callback' => 'entity_property_verbatim_set',
        'getter callback' => 'entity_property_verbatim_get',
      ),
      'description' => array(
        'type' => 'text',
        'label' => t('Blog description'),
        'setter callback' => 'entity_property_verbatim_set',
        'getter callback' => 'entity_property_verbatim_get',
      ),
      'show' => array(
        'type' => 'integer',
        'label' => t("The blog's show ID"),
        'setter callback' => 'entity_property_verbatim_set',
        'getter callback' => 'entity_property_verbatim_get',
      ),
      'season' => array(
        'type' => 'integer',
        'label' => t("The blog's season ID"),
        'setter callback' => 'entity_property_verbatim_set',
        'getter callback' => 'entity_property_verbatim_get',
      ),
      'episode' => array(
        'type' => 'integer',
        'label' => t("The blog's episode ID"),
        'setter callback' => 'entity_property_verbatim_set',
        'getter callback' => 'entity_property_verbatim_get',
      ),
      'status' => array(
        'type' => 'integer',
        'label' => t('Blog published status'),
        'setter callback' => 'entity_property_verbatim_set',
        'getter callback' => 'entity_property_verbatim_get',
      ),
    ),
  );

  return $structure;
}
